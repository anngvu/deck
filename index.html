<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dataset Deck (Loadable)</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Import Map for JSON Schema Form component -->
    <script type="importmap">
        {
            "imports": {
                "lit": "https://ga.jspm.io/npm:lit@2.8.0/index.js",
                "lit/": "https://ga.jspm.io/npm:lit@2.8.0/",
                "lit-html": "https://ga.jspm.io/npm:lit-html@2.8.0/lit-html.js",
                "lit-html/": "https://ga.jspm.io/npm:lit-html@2.8.0/",
                "lit-element/": "https://ga.jspm.io/npm:lit-element@3.3.3/",
                "@lit/reactive-element": "https://ga.jspm.io/npm:@lit/reactive-element@1.6.3/reactive-element.js",
                "@lit/reactive-element/": "https://ga.jspm.io/npm:@lit/reactive-element@1.6.1/",
                
                "@shoelace-style/shoelace/": "https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.3.0/",
                
                "lodash-es/set": "https://unpkg.com/lodash-es@4.17.21/set.js",
                
                "@jsfe/core": "https://unpkg.com/@jsfe/core@0.0.4/dist/esm-min"
            }
        }
    </script>
    
    <!-- Shoelace Styles -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.9.0/cdn/themes/dark.css"
    />
</head>
<body>

    <!-- Section for Loading Data -->
    <div id="load-data-area">
        <h1>Load Comparison Data</h1>
        <div class="load-controls">
            <label for="api-key-input">Synapse API Key:</label>
            <input type="password" id="api-key-input" placeholder="Enter your Synapse API key" required>
            <br><br>
            <label for="data-url-input">Data JSON URL:</label>
            <input type="url" id="data-url-input" placeholder="https://example.com/data.json" size="50">
            <br><br>
            <p class="schema-info">The application will load the JSON schema from:
                <code>https://raw.githubusercontent.com/nf-osi/nf-metadata-dictionary/refs/heads/main/registered-json-schemas/PortalDataset.json</code>
            </p>
            <button id="load-data-button">Load Data & Schema</button>
        </div>
        <p id="load-status-message"></p>
    </div>

    <!-- Main Application Area (Initially Hidden) -->
    <div id="main-app-area" class="hidden">
        <div id="status-area">
            <div id="navigation-area">
                <label for="goto-index">Go to comparison #:</label>
                <input type="number" id="goto-index" min="1" value="1">
                <button id="goto-button">Go</button>
            </div>
            <div id="status-message">Loading...</div>
            <div id="submit-status"></div>
        </div>


        <div id="comparison-area" class="hidden">
            <div id="card-container">
                <!-- Cards will be injected here -->
            </div>
            <form id="scoring-form">
                <div class="scoring-inputs">
                    <!-- Score inputs 1, 2, 3 -->
                    <div class="score-input">
                        <label for="score_1">Score 1 (0-10):</label>
                        <input type="number" id="score_1" name="score_1" min="0" max="10" required>
                    </div>
                    <div class="score-input">
                        <label for="score_2">Score 2 (0-10):</label>
                        <input type="number" id="score_2" name="score_2" min="0" max="10" required>
                    </div>
                    <div class="score-input">
                        <label for="score_3">Score 3 (0-10):</label>
                        <input type="number" id="score_3" name="score_3" min="0" max="10" required>
                    </div>
                </div>

                <div class="notes-input">
                    <label for="notes">Notes (optional):</label>
                    <textarea id="notes" name="notes" rows="1" placeholder="Enter any notes or observations here"></textarea>
                </div>

                <div class="form-actions">
                    <p id="validation-error" class="error-message hidden"></p>
                    <button type="submit">Submit & Next</button>
                </div>
            </form>
        </div>

        <!-- New Card Editing Area (Initially Hidden) -->
        <div id="edit-card-area" class="hidden">
            <h2>Edit Card Data</h2>
            <div id="edit-form-container">
                <!-- JSON Schema Form will be initialized here -->
                <json-schema-form id="json-schema-form"></json-schema-form>
            </div>
            <div class="form-actions">
                <button id="back-to-comparison" class="secondary-button">Cancel</button>
                <button id="save-card-changes" class="primary-button">Save Changes</button>
            </div>
        </div>

        <div id="controls-area" class="hidden"> <!-- Also initially hidden -->
            <button id="reset-button">Reset Progress</button>
        </div>

        <div id="completion-area" class="hidden">
            <h2>All Comparisons Completed!</h2>
            <p>Thank you for completing all comparisons.</p>
            <p><span id="total-results-count">0</span> results submitted.</p>
        </div>

    </div><!-- End #main-app-area -->

    <!-- Import the JSON Schema Form component -->
    <script type="module">
        import '@jsfe/core';
    </script>
    
    <script src="app.js"></script>
</body>
</html>
